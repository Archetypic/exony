# Copyright 2015 Nikolay Orliuk <virkony@gmail.com>
# Distributed under the terms of the GNU General Public License v2

SUMMARY="A sophisticated software modeler"
DESCRIPTION="
StarUML 2 is compatible with UML 2.x standard and supports totally 11 kinds of UML diagrams: Class,
Object, Use Case, Component, Deployment, Composite Structure, Sequence, Communication, Statechart,
Activity and Profile Diagram.
"
HOMEPAGE="http://staruml.io/"
DOWNLOADS="
    $HOMEPAGE/download/release/v${PV}/StarUML-v${PV}-64-bit.deb
    http://security.ubuntu.com/ubuntu/pool/main/libg/libgcrypt11/libgcrypt11_1.4.4-5ubuntu2.4_amd64.deb
"

LICENCES="
    StarUML-EULA
    GPL-2 [[ description = [ libgcrypt shipped libs ] ]]
"
SLOT="0"
PLATFORMS="~amd64"

DEPENDENCIES="
    build:
        app-arch/dpkg
    run:
        gnome-platform/GConf
        sys-sound/alsa-lib[>=1.0.23]
        dev-libs/atk[>=1.12.4]
        x11-libs/cairo[>=1.6.0]
        net-print/cups[>=1.4.0]
        sys-apps/dbus[>=1.2.14]
        dev-libs/expat[>=1.95.8]
        media-libs/fontconfig[>=2.8.0]
        media-libs/freetype[>=2.3.9]
        dev-libs/libgpg-error[>=1.6]
        x11-libs/gdk-pixbuf:2.0[>=2.22.0]
        dev-libs/glib:2[>=2.18.0]
        x11-libs/gtk+:2[>=2.24.0]
        dev-libs/nspr
        dev-libs/nss[>=3.12.6]
        x11-libs/pango[>=1.22.0]
        sys-apps/systemd[>=198]
        x11-libs/libX11[>=1.4.99.1]
        x11-libs/libXcomposite[>=0.3]
        x11-libs/libXdamage[>=1.1]
        x11-libs/libXext
        x11-libs/libXfixes
        x11-libs/libXrandr[>=1.2.0]
        x11-libs/libXrender
        app-misc/ca-certificates
        net-misc/curl
        x11-apps/xdg-utils
        net-misc/wget
"

BUGS_TO="virkony@gmail.com"
RESTRICT="strip"

pkg_setup() {
    exdirectory --allow /opt
}

src_unpack() {
    edo mkdir -pv "$WORK"
    local f
    for f in ${ARCHIVES}; do
        edo dpkg -X "$FETCHEDDIR/$f" "$WORK"
    done
}

src_install() {
    edo rm -rf usr/share/doc/libgcrypt11
    edo mv lib/libgcrypt.so.11* opt/staruml/lib/
    edo cp -aR opt usr "$IMAGE"
    local dir f
    edo find "$IMAGE" -type d -empty | while read dir; do keepdir "$dir"; done

    local libprefix="/usr/$LIBDIR"

    dosym "$libprefix/libudev.so.1" /opt/staruml/lib/libudev.so.0

    dosym /opt/staruml/staruml /usr/bin/staruml
}

pkg_postinst() {
    for icon in "/opt/staruml/appshell"*.png; do
        size="${icon##*/appshell}"
        size="${size%.png}"
        edo xdg-icon-resource install --novendor --size "$size" "$icon" "staruml"
    done
}

